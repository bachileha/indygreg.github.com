


<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<!--
Design by Free CSS Templates
http://www.freecsstemplates.org
Released for free under a Creative Commons Attribution 2.5 License

Name       : Pollinating  
Description: A two-column, fixed-width design with dark color scheme.
Version    : 1.0
Released   : 20101114

-->
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    
  <title>Gregory Szorc'c Digital Home</title>
<link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="/blog/feed" />
<link rel="alternate" type="application/atom+xml" title="Atom 1.0"
href="/blog/feed/atom" />
<link rel="stylesheet" href="/style/style.css" type="text/css" />
<link rel="stylesheet" href="/css/pygments_murphy.css" type="text/css" />


  </head>
  <body>
    <div id="wrapper">
      
  <div id="menu">
  <ul>
    <li><a href="/">Home</a></li>
    <li><a href="/blog/">Blog</a></li>
    <li><a href="/notes">Notes</a></li>
    <li><a href="/work.html">Work</a></li>
    <li><a href="/skills.html">Skills</a></li>
    <li><a href="/thoughts.html">Thoughts</a></li>
    <li><a href="/resume.pdf">Resume</a></li>
  </ul>
</div>


      <div id="page">
        <div id="page-bgtop">
          <div id="page-bgbtm">
              <div id="content">
                
  
<div class="blog_post">
  <a name="makefile-execution-times"></a>
  <h2 class="blog_post_title"><a href="/blog/2012/07/28/makefile-execution-times" rel="bookmark" title="Permanent Link to Makefile Execution Times">Makefile Execution Times</a></h2>
  <small>July 28, 2012 at 12:45 AM | categories: 

<a href='/blog/category/mozilla'>Mozilla</a>, <a href='/blog/category/pymake'>pymake</a>, <a href='/blog/category/build-system'>build system</a>
 | <a href="http://gregoryszorc.com/blog/2012/07/28/makefile-execution-times#disqus_thread">View Comments</a>
</small><p/>
  <div class="post_prose">
    
  <p>In my course of hacking about with Mozilla's build system, I've been
using pymake (a Python implementation of GNU make) to parse, examine,
and manipulate make files. In doing so, I've learned some interesting
things, dispelling myths in the process.</p>
<p>People often say that parsing make files is slow and that the sheer
number of Makefile.in's in mozilla-central (Firefox's source tree) is
leading to lots of overhead in make execution. This statement is only
partially correct.</p>
<p><em>Parsing</em> make files is actually pretty fast. Using pymake's parser API,
I'm able to parse every Makefile.in in mozilla-central in under 5
seconds on my 2011 generation MacBook Pro using a single core. Not too
shabby, especially considering that there are about 82,500 lines in all
the Makefile.in's.</p>
<p>Evaluation of make files, however, is a completely different story. You
see, parsing a string containing make file directives is only part of
what needs to be done. Once you've parsed a make file into a statement
list (essentially an AST), you need to load that into a data structure
fit for evaluation. Because of the way make files are evaluated,
you need to iterate through every parsed statement and evaluate it
for side-effects. This occurs before you actually evaluate specific
targets in the make file itself. As I found out, this process can be
time-consuming.</p>
<p>For mozilla-central, the cost of loading the statement list into a data
structure ready for target evaluation takes about 1 minute in aggregate.
And, considering we effectively iterate through every Makefile in
mozilla-central 3 times when building (once for every tier state of
export, libs, and tools), you can multiply this figure by 3.</p>
<p>Put another way, <em>parsing</em> Makefile's is fast: loading them for
target evaluation is slow.</p>
<p>Digging deeper, I uncovered the main source of the additional overhead:
<em>rules.mk</em>.</p>
<p>Nearly every Makefile in mozilla-central has a pattern that looks like:</p>
<pre><code>DEPTH = ../..
topsrcdir = @top_srcdir@
srcdir = @srcdir@
VPATH = @srcdir@

include $(DEPTH)/config/autoconf.mk

&lt;LOCAL MAKE FILE DECLARATIONS&gt;

include $(topsrcdir)/config/rules.mk
</code></pre>
<p>We have a header boilerplate, followed by a bunch of Makefile-specific
variables definitions and rules. Finally, we include the <em>rules.mk</em>
file. This is the make file that takes specially-named variables and
converts them to rules (actions) for make to perform.</p>
<p>A typical Makefile.in is a few dozen lines or so. This often reduces to
maybe a dozen parsed statements. By contrast, <em>rules.mk</em> is massive. It
is currently 1770 lines and may include other make files, bringing the
total to ~3000 lines.</p>
<p>Pymake has an LRU cache that caches the results of <em>parsing</em> make files.
This means it only has to parse a single make file into a statement list
once (assuming no cache eviction). <em>rules.mk</em> is frequently used, so it
should have no eviction. Even if it were evicted, I've measured that
<em>parsing</em> is pretty fast.</p>
<p>Unfortunately, the cache doesn't help with evaluation. For every
Makefile in mozilla-central, pymake will need to evaluate rules.mk
within the context of that specific Makefile. It's impossible to cache
the results of a previous evaluation because the side-effects of rules.mk
are determined by what is defined in the Makefile that includes it.</p>
<p>I performed an experiment where I stripped the <em>include rules.mk</em>
statement from all parsed Makefile.in's. This essentially isolates the
overhead of loading <em>rules.mk</em>. It turns out that all but ~2 seconds
of evaluation time is spent in <em>rules.mk</em>. In other words,
without <em>rules.mk</em>, the Makefile.in's are loaded and ready for evaluation
in just a few seconds (over parsing time), not ~1 minute!</p>
<p>What does this all mean?</p>
<p>Is <em>parsing</em> make files slow? Technically no. <em>Parsing</em> itself is not slow.
It is actually quite fast! Pymake even surprised me at how fast it can
parse all the Makefile.in's in mozilla-central.</p>
<p><em>Loading</em> parsed make file statements to be ready for evaluation is
actually the bit that is slow - at least in the case of mozilla-central.
Specifically, the loading of <em>rules.mk</em> is what constitutes the
overwhelming majority of the time spent loading Makefile's.</p>
<p>That being said, <em>parsing</em> and <em>loading</em> go hand in hand. You almost
never parse a make file without loading and evaluating it. So, if you
consider <em>parsing</em> to include parsing <em>and</em> readying the make file for
execution, there is some truth to the statement that parsing make files
is slow. Someone splitting hairs may say differently.</p>
<p>Is there anything we can do? Good question.</p>
<p>I believe that build times of mozilla-central can be reduced by reducing
the size of <em>rules.mk</em>. Obviously, the content of <em>rules.mk</em> is
important, so we can't just delete content. But, we can be more
intelligent about how it is loaded. For example, we can move pieces of
<em>rules.mk</em> into separate <em>.mk</em> files and conditionally include these
files based on the presence of specific variables. We already do this
today, but only partially: there are still a number of bits of rules.mk
that could be factored out into separate files. By conditionally loading
make file content from <em>rules.mk</em>, we would be reducing the number of
statements that need to be loaded before evaluating each Makefile. And,
this should, in turn, make build times faster. Keep in mind that any
savings will be multiplied by roughly 3 since we do 3 passes over
Makefile's during a build.</p>
<p>To my knowledge, there aren't any bugs yet on file to do this. Given the
measurements I've obtained, I encourage somebody to do this work. Even
if it doesn't reduce build times, I think it will be a win since it will
make the make rules easier to understand since they will be contained in
function-specific files rather than one monolithic file. At worse, we
have better readability. At best, we have better readability and faster
build times. Win!</p>
<p>Finally, I don't know what the impact on GNU make is. Presumably, GNU
make evaluates make files faster than pymake (C is generally faster than
python). Therefore, reducing the size of <em>rules.mk</em> should make GNU make
faster. By how much, I have no clue.</p>

  </div>
</div>



  <div class="after_post"><a href="http://gregoryszorc.com/blog/2012/07/28/makefile-execution-times#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
  
<div class="blog_post">
  <a name="mozilla-build-system-plan-of-attack"></a>
  <h2 class="blog_post_title"><a href="/blog/2012/07/25/mozilla-build-system-plan-of-attack" rel="bookmark" title="Permanent Link to Mozilla Build System Plan of Attack">Mozilla Build System Plan of Attack</a></h2>
  <small>July 25, 2012 at 11:30 PM | categories: 

<a href='/blog/category/mozilla'>Mozilla</a>, <a href='/blog/category/build-system'>build system</a>
 | <a href="http://gregoryszorc.com/blog/2012/07/25/mozilla-build-system-plan-of-attack#disqus_thread">View Comments</a>
</small><p/>
  <div class="post_prose">
    
  <p>Since I published my <a href="http://gregoryszorc.com/blog/2012/06/25/improving-mozilla%27s-build-system/">brain dump
post</a>
on improving Mozilla's build system for Gecko applications (including
Firefox and Firefox OS), there has been some exciting progress.</p>
<p>It wasn't stated in that original post, but the context for that post
was to propose a plan in preparation of a meeting between the core
contributors to the build system at Mozilla. I'm pleased to report that
the plan was generally well-received.</p>
<p>We pretty much all agreed that parts 1, 2, and 3 are all important and
we should actively work towards them. Parts 4, 5, and 6 were a bit more
contentious. There are some good parts and some bad parts. We're not
ready to adopt them just quite yet. (Don't bother reading the original
post to look up what these parts corresponded to - I'll cover that
later.)</p>
<p>Since that post and meeting, there has also been additional discussion
around more specifics. I am going to share with you now where we stand.</p>
<h2>BuildSplendid</h2>
<p><strong>BuildSplendid</strong> is an umbrella term associated with projects/goals to
make the developer experience (including building) better - more
splendid if you will.</p>
<p><strong>BuildSplendid</strong> started as the name of my personal Git branch for
hacking on the build system. I'm encouraging others to adopt the term
because, well, it is easier to refer to (people like project codenames).
If it doesn't stick, that's fine by me - there are other terms that
will.</p>
<h2>BuildFaster</h2>
<p>An important project inside <em>BuildSplendid</em> is <strong>BuildFaster</strong>.</p>
<p><em>BuildFaster</em> focuses on the following goals:</p>
<ol>
<li>Making the <em>existing</em> build system faster, better, stronger (but not
   harder).</li>
<li>Making changes to the build system to facilitate the <em>future</em> use of
   alternate build backends (like Tup or Ninja). Work to enable Visual
   Studio, Xcode, etc project generation also falls here.</li>
</ol>
<p>The distinction between these goals can be murky. But, I'll try.</p>
<p>Falling squarely in #1 are:</p>
<ul>
<li>Switching the buildbot infrastructure to use pymake on Windows</li>
</ul>
<p>Falling in #2 are:</p>
<ul>
<li>Making Makefile.in's data-centric</li>
<li>Supporting multiple build backends</li>
</ul>
<p>Conflated between the two are:</p>
<ul>
<li>Ensuring Makefile's no-op if nothing has changed</li>
<li>Optimizing existing make rules. This involves merging related
  functionality as well as eliminating clown shoes in existing rules.</li>
</ul>
<p>The two goals of <em>BuildFaster</em> roughly map to the short-term and long-term
strategies, respectively. There is consensus that recursive make (our
existing build backend) does not scale and we will plateau in terms of
performance no matter how optimal we make it. That doesn't mean we are
giving up on it: there are things we can and should do so our existing
non-recursive make backend builds faster.</p>
<p>In parallel, we will also work towards the longer-term solution of
supporting alternate build backends. <strong>This includes non-recursive
make</strong> as well as things like Tup, Ninja, and even Visual Studio and
Xcode. (I consider non-recursive make to be a separate build backend
because changing our existing Makefile.in's to support non-recursive
execution effectively means rewriting the input files (Makefile.in's).
At that point, you've invented a new build backend.)</p>
<p>For people who casually interact with the build system, these two goals
will blend together. It is not important for most to know what bucket
something falls under.</p>
<h3>BuildFaster Action Items</h3>
<p><em>BuildFaster</em> action items are being tracked in Bugzilla using the
[BuildFaster:*] whiteboard annotation.</p>
<p>There is no explicit tracking bug for the short-term goal (#1). Instead,
we are relying on the whiteboard annotation.</p>
<p>We are tracking the longer-term goal of supporting alternate build
backends at <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=774049">bug 774049</a>.</p>
<p>The most important task to help us reach the goals is to make our
Makefile.in's data centric. This means:</p>
<ul>
<li>Makefile.in's <strong>must</strong> consist of only simple variable assignment</li>
<li>Makefile.in's <strong>must</strong> not rely on being evaluated to perform variable
  assignment.</li>
</ul>
<p>Basically, our build config should be defined by static key-value pairs.</p>
<p>This translates to:</p>
<ul>
<li>Move all rules out of Makefile.in's <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=769378">bug 769378</a></li>
<li>Remove use of $(shell) from Makefile.in's <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=769390">bug 769390</a></li>
<li>Remove filesystem functions from Makefile.in's <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=769407">bug 769407</a></li>
<li>And more, as we identify the need</li>
</ul>
<p>While we have these tracking bugs on file, we still don't have bugs
filed that track individual Makefile.in's that need updated. <strong>If you
are a contributor, you can help by doing your part to file bugs for your
Makefile.in's.</strong> If your Makefile.in violates the above rules, please
file a bug in the <strong>Build Config</strong> component of the product it is under
(typically <strong>Core</strong>). See the tree of the above bugs for examples.</p>
<p>Also part of <em>BuildFaster</em> (but not relevant to most) is the task of
changing the build system to support multiple backends. Currently,
pieces like <em>configure</em> assume the Makefile.in to Makefile conversion is
always what is wanted. These parts will be worked on by core
contributors to the build system and thus aren't of concern to most.</p>
<p>I will be the first to admit that a lot of the work to <em>purify</em>
Makefile.in's to be data centric will look like a lot of busy work with
little immediate gain. The real benefits to this work will manifest
down the road. That being said, removing rules from Makefile.in's and
implementing things as rules in rules.mk helps ensure that the
implementation is proper (rules.mk is coded by make ninjas and thus
probably does things <em>right</em>). This can lead to faster build times.</p>
<h2>mozbuild</h2>
<p><strong>mozbuild</strong> is a Python package that provides an API to the build system.</p>
<p>What <em>mozbuild</em> will contain is still up in the air because it hasn't
landed in mozilla-central yet. In the code I'm waiting on review to
uplift to mozilla-central, <em>mozbuild</em> contains:</p>
<ul>
<li>An API for invoking the build system backend (e.g. launching make). It
  basically reimplements client.mk because client.mk sucks and needs to
  be replaced.</li>
<li>An API for launching tests easily. This reimplements functionality in
  testsuite-targets.mk, but in a much cleaner way. Running a single test
  can now be done with a single Python function call. This may sound
  boring, but it is very useful. You just import a module and pass a
  filesystem path to a test file to a function and a test runs. Boom!</li>
<li>Module for extracting compiler warnings from build output and storing
  in a persisted database for post-build retrieval. Compiler warning
  tracking \o/</li>
<li>Module for converting build system output into structured logs. It
  records things like time spent in different directories, etc. We could
  use this for tracking build performance regressions. We just need a
  arewe*yet.com domain...</li>
<li>A replacement for .mozconfig's that sucks less (stronger validation,
  settings for not just build config, convenient Python API, etc).</li>
</ul>
<p>And, upcoming features which I haven't yet tried to land in
mozilla-central include:</p>
<ul>
<li>API for extracting metadata from Makefile.in's and other frontend
  files. Want a Python class instance describing the IDLs defined in an
  individual Makefile.in or across the entire tree? <em>mozbuild</em> can provide
  that. This functionality will be used to configure alternate build
  backends.</li>
<li>Build backend API which allows for different build backends to be
  configured (e.g. recursive make, Tup, Ninja, etc). When we support
  multiple build backends, they'll live in <em>mozbuild</em>.</li>
</ul>
<p><em>mozbuild</em> can really be thought of as a clean backend to the build
system and related functionality (like running tests). Everything in
<em>mozbuild</em> could exist in make files or in .py files littered in
<em>build/</em>, <em>config/</em>, etc. But, that would involve maintaining make files
and/or not having a cohesive API. I wanted a clean slate that was free
from the burdens of the existing world. <em>mozbuild</em> was born.</p>
<p>I concede that there will be non-clear lines of division between
<em>mozbuild</em> and other Python packages and/or Mozilla modules. For
example, is <em>mozbuild</em> the appropriate location to define an API for
taking the existing build configuration and launching a Mochitest? I'm
not sure. For now, I'm stuffing functionality inside <em>mozbuild</em> unless
there is a clear reason for it to exist elsewhere. If we want to
separate (because of module ownership issues, for example), we can do
that.</p>
<p>My vision for <em>mozbuild</em> is for it to be the answer to the question
<em>how does the Mozilla build system work?</em> You should be able to say,
<em>look at the code in python/mozbuild and you will have all the answers.</em></p>
<h3>mozbuild Action Items</h3>
<p>The single action item for <em>mozbuild</em> is getting it landed. I have code
written that I think is good enough for an initial landing (with obvious
shortcomings being addressed in follow-up bugs). It just needs some love
from reviewers.</p>
<p>Landing <em>mozbuild</em> is tracked in
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=751795">bug 751795</a>. I
initially dropped a monolithic patch. I have since started splitting
bits up into bite-sized patches to facilitate faster, smaller reviews.
(See the blocking bugs.)</p>
<h2>mach</h2>
<p><em>mozbuild</em> is just a Python package - an API. It has no frontend.</p>
<p>Enter <strong>mach</strong>.</p>
<p><strong>mach</strong> is a command-line frontend to <em>mozbuild</em> and beyond.</p>
<p>Currently, <em>mach</em> provides some convenient shortcuts for performing
common tasks. e.g. you can run a test by tab-completing to its filename
using your shell. It also provides nifty output in supported terminals,
including colorizing and a basic progress indicator during building.</p>
<p>You can think of <em>mach</em> as a replacement for <em>client.mk</em> and other make
targets. But, <em>mach</em>'s purpose doesn't end there. My vision for <em>mach</em>
is for it to be the one-stop shop for all your mozilla-central
interaction needs.</p>
<p>From a mozilla-central tree, you should be able to type
<strong>./mach <action></strong> and do whatever you need to do. This could be
building Firefox, running tests, uploading a patch to Bugzilla, etc.</p>
<p>I'm capturing ideas for <em>mach</em> features in
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=774108">bug 774108</a>.</p>
<h3>mach Action Items</h3>
<p><em>mach</em> is in the same boat as <em>mozbuild</em>: it's waiting for reviewer
love. If you are interested in reviewing it, please let me know.</p>
<p>Once <em>mach</em> lands, I will be looking to the larger community to improve
it. I want people to go wild implementing features. I believe that
<em>mach</em> will have a significant positive impact on driving contributions
to Mozilla because it will make the process much more streamlined and
less prone to error. I think it is a no-brainer to check in <em>mach</em> as
soon as possible so these wins can be realized.</p>
<p>There is an open question of who will own <em>mach</em> in terms of module
ownership. <em>mach</em> isn't really part of anything. Sure, it interacts with
the build system, testing code, tools, etc. But, it isn't actually part
of any of that. Maybe a new module will be created for it. I'm not
familiar with how the modules system works and I would love to chat with
someone about options here.</p>
<h2>Project Interaction</h2>
<p>How are all of these projects related?</p>
<p><em>BuildFaster</em> is what everyone is working on today. It currently focuses
on making the existing recursive make based build backend faster using
whatever means necessary. <em>BuildFaster</em> could theoretically evolve to
cover other build backends (like non-recursive make). Time will tell
what falls under the <em>BuildFaster</em> banner.</p>
<p><em>mozbuild</em> is immediately focused on providing the functionality to
enable <em>mach</em> to land.</p>
<p><em>mach</em> is about improving the overall developer experience when
it comes to contributing to Firefox and other in-tree applications (like
Firefox OS). It's related to the build system in that it provides a nice
frontend to it. That's the only relationship. <em>mach</em> isn't part of the
build system (at least not yet - it may eventually be used to perform
actions on buildbot machines).</p>
<p>Down the road, <em>mozbuild</em> will gain lots of new features core to the
build system. It will learn how to extract metadata from Makefile.in's
which can be used by other build backends. It will define a build
backend interface and the various build backends will be implemented
in mozbuild. Aspects of the existing build system currently implemented in
make files or in various Python files scattered across the tree will be
added to <em>mozbuild</em> and exposed with a clean, reusable, and testable
API.</p>
<p>Today, <em>BuildFaster</em> is the important project with all the attention.
When <em>mach</em> lands, it will (hopefully) gather a lot of attention. But,
it will be from a different group (the larger contributor community -
not just build system people).</p>
<p><em>mozbuild</em> today is only needed to support <em>mach</em>. But, once <em>mozbuild</em>
lands and <em>mach</em> is on its own, <em>mozbuild</em>'s purpose  will shift to support
<em>BuildFaster</em> and other activities under the <em>BuildSplendid</em> banner.</p>
<h2>Conclusion</h2>
<p>We have a lot of work ahead of us. Please look at the bugs linked above
and help out in any way you can.</p>

  </div>
</div>



  <div class="after_post"><a href="http://gregoryszorc.com/blog/2012/07/25/mozilla-build-system-plan-of-attack#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />
  
<div class="blog_post">
  <a name="one-year-at-mozilla"></a>
  <h2 class="blog_post_title"><a href="/blog/2012/07/18/one-year-at-mozilla" rel="bookmark" title="Permanent Link to One Year at Mozilla">One Year at Mozilla</a></h2>
  <small>July 18, 2012 at 12:00 AM | categories: 

<a href='/blog/category/mozilla'>Mozilla</a>, <a href='/blog/category/firefox'>Firefox</a>, <a href='/blog/category/sync'>Sync</a>
 | <a href="http://gregoryszorc.com/blog/2012/07/18/one-year-at-mozilla#disqus_thread">View Comments</a>
</small><p/>
  <div class="post_prose">
    
  <p>It is hard to believe that my first day as a full-time employee of Mozilla
was one year ago today! But, here I am. And, I'd like to think the past
year is worth reflecting on.</p>
<p>So, what have I been doing for a year? Good question!</p>
<h2>Accomplishments</h2>
<ul>
<li>First patch and commit to Firefox: <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=673209">bug 673209</a>.
  Yes, my first patch was to configure.in. It scared me too.</li>
<li>Number of non-merge commits: 133</li>
<li>Number of merge commits: 49</li>
<li>Number of reviews: 31</li>
<li>Favorite commit message: <a href="https://hg.mozilla.org/mozilla-central/rev/88d02a07d390">88d02a07d390</a>
  <em>Fix bug 725478 because we run a buggy Python released almost 5 years
  ago; r=tigerblood</em> (it was a bustage follow-up).</li>
<li>Biggest mistake: buildbotcustom change to packaging turned every tree
  red. All of them. Including release. I think I have philor on record
  saying it is the worst burnage he's ever seen. Mission accomplished!</li>
</ul>
<p>Major User-Facing Features:</p>
<ul>
<li>Wrote add-on sync for Firefox (with help from many others, especially
  Dave Townsend and Blair McBride).</li>
<li>Principle reviewer for Apps in the Cloud (apps sync) in Firefox. (Are
  reviewers allowed to take credit?)</li>
</ul>
<p>Honestly, when I see that list, I think <em>that's all?</em> It doesn't feel
like a lot, especially since I work on a major user-facing feature
(Firefox Sync). I do contribute to more. But, if you ask me what the
most significant impact was, I don't think I can call anything else out
as <em>major</em>.</p>
<p>There are certainly a lot of minor things:</p>
<ul>
<li>Actually managed to understand how Firefox Sync works, including the
  crypto model. I even <a href="http://docs.services.mozilla.com/sync/storageformat5.html">documented</a>
  it! I don't think I knew any of that when I started (I basically knew
  that Firefox Sync was using strong client-side encryption. What that
  meant, I had no clue.)</li>
<li>Filed initial bugs (including some patches) to compile mozilla-central
  on Windows 8 and MSVC 2011. By the time people started working on
  Metro development, mozilla-build, configure, and the like already
  supported building.</li>
<li>Configured <a href="https://ci.mozilla.org/job/sync-android/">Android Sync Jenkins Builder</a>.
  I'm told the Android Sync team loves it! You gotta love all the
  built-in dashboards. I really wish we had this for mozilla-central.</li>
<li>Made xpcshell test harness write xUnit files. Machine readable output
  of test results, baby!</li>
<li>Implement <em>send tab to device</em> API in Firefox Sync. Too bad we don't
  have UX to use it :(</li>
<li>Implemented testing-only JavaScript modules. So, instead of the hack
  that is [head] files in tests, you can
  <em>Cu.import("resource://testing-common/foo.js");</em></li>
<li>Made test package generation quieter. This made build logs about 30%
  smaller. This means you can get at build results faster.</li>
<li>Hacked around with JavaScript code coverage using the JS Debugger API.
  Failed in the process. But, I learned a lot about the JS Debugger API,
  so I consider it a win.</li>
<li>Rewrote Firefox Sync's record reconciling algorithm. The old one was
  full of subtle data loss corner cases. The new algorithm is much more
  robust (we think - even with 3 reviewers there was still some head
  scratching).</li>
<li>Emancipated lots of generic JavaScript code from the Sync tree into
  the a <em>services-common</em> package. This anticipated Apps in the Cloud
  and notifications' requirement to use this functionality and allowed
  those projects to get going quicker. At this point, we're effectively
  running a mini Toolkit. We really need to port some of this
  <em>upstream</em>.</li>
<li>Helped design the <a href="http://docs.services.mozilla.com/storage/apis-2.0.html">next version</a>
  of the HTTP service to be used by Sync.</li>
<li>Implemented a standalone JavaScript implementation of the above. The
  production server used by Mozilla runs on Python (running the Python
  server in Mozilla's test environment would be too difficult). The
  server was also implemented using just the spec. This allowed us to
  clarify many parts of the spec. The Python functional tests can also
  be executed against the JS server. This gives us confidence that
  functionality is equivalent and tests hitting the test/JS server will
  behave the same as if they are hitting the production Python server.</li>
<li>Implemented a standalone JavaScript
  <a href="https://hg.mozilla.org/mozilla-central/file/default/services/common/storageservice.js">client</a>  for the above service. Previously, all the logic for this was scattered
  over about a dozen files and was notoriously difficult to audit and
  update. I also think it is a decent example of good code.  Clean.
  Highly documented. No hacks.</li>
<li>Reviewed a skeleton for the notifications service, which will
  eventually power browser notifications in Firefox.</li>
<li>Build system patches to better support Clang. Thankfully, Rafael
  Espíndola has been our Clang champion as of late and is now ensuring
  the bleeding edge of Clang does not break the tree. Thanks, Rafael! (I
  actually think he is in the process of switching our OS X builds to
  use Clang as I type this!)</li>
<li>Worked with security and crypto people to devise the security model
  behind the next version of Firefox Sync. (Brian Warner and Ben Adida
  have been doing most of the crypto work. I'm mostly on the sidelines
  making sure they design a system that can easily interop with Sync.)</li>
<li>Helped devise the <a href="http://docs.services.mozilla.com/sync/storageformat6.html">next version</a>
  of Sync's server-side storage format. This will make the next version
  of Sync faster and able to hold more data at lower server cost.</li>
<li>Gave lots of love to documentation at
  <a href="http://docs.services.mozilla.com/">https://docs.services.mozilla.com/</a>
  (especially the Sync docs). It's almost at the point where others can
  implement Sync clients without having to ask one of the fewer than 10
  people on the planet who actually know.</li>
<li>Contributed many small patches to the build system. Mostly general
  cleanup so far. Although, I have much bigger plans in the works.</li>
<li>Many miscellaneous small things. (I get distracted easily.)</li>
</ul>
<p>Well, that list doesn't seem too shabby. But, a lot of it is smaller
ticket items. I don't think there's anything there worth writing home
about.  Whatever. The future is looking bright for Firefox Sync (Persona
integration will make Sync usable by millions more) and new sync
backends are coming (including search engine sync). So, I'm fine with
not having a longer list of big ticket contributions after only a year.</p>
<h2>On Ramping up at Mozilla</h2>
<p>I will be the first to admit that I had a difficult time getting into
the groove at Mozilla and my first months (dare I say my first half
year) were unproductive by my personal standards.</p>
<p>I can't say I wasn't warned. My manager (Mike Connor) told me
multiple times that it would happen. I was skeptical, insteading
rationalizing that my previous track record of learnly quickly
would hold. He was right. I was wrong. I got fat from the humble pie.</p>
<p>There are a few reasons for this. For starters, I was starting a new
job. It's almost impossible achieve 100% productivity on your first day.
Second, I was working with tools I knew little about, including
JavaScript and especially including the flavor of JavaScript used
inside Firefox. (Short version: the JavaScript within Firefox is awesome
in that it implements bleeding-edge features of the language.
Unfortunately, the JavaScript inside Firefox/Gecko is contaminated
by this blight called XPCOM. It makes things ugly and not very
JavaScript-y. XPCOM also makes the learning curve that much harder
because now you have to learn multiple technologies at the same time.)
It was daunting.</p>
<p>Not helping matters was the fact that Firefox Sync is complicated.
Syncing data is in of itself a difficult problem. Throw in remote
servers, an HTTP protocol, a encryption, and interaction with systems
inside Firefox that are themselves complicated, and you have a <strong>hard</strong>
problem. My first months were literally spent being a thorn in Philipp
von Wieter^H^H^H^H^H^H philikon's side, barraging him with an endless
stream of questions. I am forever in beer debt to him because of this.
When Philipp left the team to work on Boot 2 Gecko and the rest of the
Firefox Sync team was retasked to work on Android Sync shortly
thereafter, I was on my own little island to manage Firefox Sync.
I kind of felt like Tom Hanks' character in <em>Castaway</em>.</p>
<p>If I have one piece of advice for people starting at Mozilla it's this:
be prepared to be humbled by your own ignorance. There is a lot to
learn. It's not easy. Don't feel bad when you struggle. The payoff is
worth it.</p>
<h2>On Life at Mozilla</h2>
<p>Despite the hurdles I initially faced ramping up at Mozilla, life at
Mozilla is great. This mostly stems from the people, of course.</p>
<p>If you are just looking for technical excellence, I think Mozilla has
one of the highest concentrations of any company in the world. Sure,
larger companies will have <em>more</em> amazing individuals. But, the number
per capita at Mozilla is just staggering. I don't know how many times
I've met or talked with someone only to find out later they are
considered to be one of the best in his or her respective field. Reading
Mozilla's phonebook is like looking at a <em>Who's Who</em> list. For someone
like me who loves being a sponge for knowledge, Mozilla is an environment
in which I can thrive. Just thinking back at everything I've learned in
the past year makes my mind asplode.</p>
<p>On the personal front, the personalities of Mozillians are also top
notch. People are generally helpful and supportive. (They need to be for
an open source project to thrive.) People recognize good ideas when they
hear them and there is comparatively few political battles to be won
when enacting change. People themselves are generally interesting and
passionate about the world and the work they do. If you are living
inside the Mozilla bubble, you may not realize how lucky you have it.
I could give specific examples, but I'd be writing all night. Just
take my word for it.</p>
<p>If you need something to whet your appetite, just check out the
zaniness that is <a href="http://mozillamemes.tumblr.com/">Mozilla Memes</a>.
I don't expect you to understand many of the posts unless you are a
Mozillian or follower of Reddit and know what internet memes are. But, if
you are either, it pretty much sums up a large part of the culture for
you. Sometimes I feel like I'm living in one giant, happy meme.</p>
<p>One of the aspects I love most about working at Mozilla is I finally
feel that my career interests are aligned with an organization I
philosophically agree with. Just read the
<a href="https://www.mozilla.org/about/manifesto.html">Mozilla Manifesto</a>. What's
not to like?</p>
<p>This is one of the primary factors that convinced me to join Mozilla.
After Microsoft acquired the startup where I had my first post-college
job (Tellme Networks), I could never hold my head high in Silicon Valley
among my friends in the tech sector. <em>Normal</em> people and those outside
of Silicon Valley were like, "Microsoft, cool!" But, something just
didn't feel right about saying I worked for them. I felt like I was working
for the Empire while I really wanted to be working for the Rebel Alliance.
I felt like I had to atone for my time at Microsoft. I felt like I needed
to cleanse my soul. Mozilla was an obvious answer.</p>
<p>(I don't mean to disparage Microsoft. I actually think the culture has
changed since the days when their behavior earned them the reputation
that Silicon Valley stills holds them accountable for. Still, I would
not work for them in Silicon Valley. Anyway, I'm not here to talk about
the past.)</p>
<p>Mozilla is an organization I'm proud to work for. I exercise that pride
by frequently wearing my awesome Firefox hoodie. Nearly every time I do,
random people come up to me and say how they love Firefox and/or what
Mozilla does for the world. Every time they do, it brings a smile to my
face. This constantly reinforces what I know to be true: that I'm
working for a great organization.</p>
<h2>Future at Mozilla</h2>
<p>I'm already looking forward to the next year at Mozilla. It is already
shaping up to be much, much more productive than my first.</p>
<p>On the roadmap, all of my hacking about with the build system is about
to pay dividends. Ever since my first day at Mozilla I have been
frustrated with the build system and the developer experience one must
go through to contribute to Firefox. After many months of casual (mostly
evenings and weekends) experimentation, my work is about to pay off.</p>
<p>I have successfully formulated a <a href="http://gregoryszorc.com/blog/2012/06/25/improving-mozilla%27s-build-system/">plan of attack</a>
and helped convince others this is what we need to do. We have since
<a href="http://coop.deadsquid.com/2012/07/reviving-buildfaster-plan-of-attack/">committed</a>
to the fundamental components of that plan and are
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=774049">tracking</a> its
progress. (I don't mean to take sole or even primary responsibility for
this as the credit resides with a number of people. But, I would like to
think that the dozens of times I championed aspects of this plan in IRC
and in hallway chats before I was the first person to articulate it in a
post helped lay the groundwork for the eventual acceptance of this
project.) Once we see progress on this project, great things will come
from it. I promise.</p>
<p>My work towards making the build system faster had an unintended
consequence: the creation of a new tool that serves as a frontend to the
build system. One day, I took a step backwards and realized that the
potential for such a tool is much greater than simply interacting with
the build system. So, I extracted that work from my build system
hacking and polished it up a bit. It is now
<a href="https://bugzilla.mozilla.org/show_bug.cgi?id=751795">one review away</a>
from landing. When it does, thousands of Firefox developers will have a
much better experience when developing Firefox. And, my hope is for
<a href="https://bugzilla.mozilla.org/showdependencytree.cgi?id=774108">many more features</a>
to follow to make it even more awesome, especially for first-time
contributors. I believe this is important to help advance Mozilla's
Mission.</p>
<p>Improving the developer experience of Firefox is exciting and it will
likely make a lot of people really happy. But, it's neither the most
exciting nor most important project I'll contribute to in the upcoming
year. The most exciting and important project for me will be
refactoring Firefox Sync to make it faster, more robust, sync more data,
and, most importantly, usable by more people.</p>
<p>Firefox Sync stands out from similar products in that it keeps your data
safe. Really safe. I
<a href="http://gregoryszorc.com/blog/2012/04/08/comparing-the-security-and-privacy-of-browser-syncing/">blogged</a>
about this previously. But, I intentionally kept the tone of that post
neutral and factual. The truth is that the security model of Firefox Sync
makes it look like nearly all other products aren't even trying. I take
immense pride in working on a data-sharing feature that makes users'
lives better <strong>without undermining security</strong>. Firefox Sync stands in
rare company in this regard.</p>
<p>Unfortunately, in our zeal for the best security possible, we designed a
product that isn't usable by the majority of people because it is too
complicated to set up and is prone to losing your data. In the end, this
doesn't really serve the overall Firefox user base.</p>
<p>We've been hard at work devising the next version of Firefox Sync which
will retain the optimum security and privacy settings of the existing
product while extending usability at nearly-comparable security and
ofer data recovery to the vast majority of our users. <strong>This is huge.</strong></p>
<p>Yeah, I'm pretty damn excited about my next year at Mozilla.</p>

  </div>
</div>



  <div class="after_post"><a href="http://gregoryszorc.com/blog/2012/07/18/one-year-at-mozilla#disqus_thread">Read and Post Comments</a></div>
  <hr class="interblog" />

              </div>
              
          <div id="sidebar">
          <ul>
            <li>
              <h2>Categories</h2>
              <ul>
                <li><a href="/blog/category/clang">Clang</a></li>
                <li><a href="/blog/category/firefox">Firefox</a></li>
                <li><a href="/blog/category/mozilla">Mozilla</a></li>
                <li><a href="/blog/category/python">Python</a></li>
                <li><a href="/blog/category/sync">Sync</a></li>
                <li><a href="/blog/category/browsers">browsers</a></li>
                <li><a href="/blog/category/build-system">build system</a></li>
                <li><a href="/blog/category/compilers">compilers</a></li>
                <li><a href="/blog/category/internet">internet</a></li>
                <li><a href="/blog/category/make">make</a></li>
                <li><a href="/blog/category/misc">misc</a></li>
                <li><a href="/blog/category/movies">movies</a></li>
                <li><a href="/blog/category/pymake">pymake</a></li>
                <li><a href="/blog/category/security">security</a></li>
                <li><a href="/blog/category/testing">testing</a></li>
              </ul>
            </li>
          </ul>
        </div>



              <div style="clear: both;">&nbsp;</div>
          </div>
        </div>
      </div>
      <div id="footer">
        
  <hr/>
  <p>Copyright (c) 2012 Gregory Szorc. All rights reserved. Design by <a href="http://www.freecsstemplates.org/"> CSS Templates</a>.</p>


      </div>
    </div>
  </body>
</html>





